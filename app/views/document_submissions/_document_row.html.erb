<!-- app/views/document_submissions/_document_row.html.erb -->
<!-- ğŸ”¥ ACTUALIZADA - SIN validation_status, SOLO document_status -->

<tr id="document-row-<%= submission.id %>">
  <td>
    <strong><%= submission.document_type&.name %></strong>
  </td>
  <td>
    <% if submission.document_file.attached? %>
      <span class="badge <%= submission.status_badge_class %>">
        <%= submission.document_status&.name || 'Desconocido' %>
      </span>
    <% else %>
      <span class="badge bg-secondary">Pendiente Solicitud</span>
    <% end %>
  </td>
  <td>
    <% if submission.submitted_at %>
      <small><%= submission.submitted_at.strftime('%d/%m/%Y') %></small>
    <% else %>
      <span class="text-muted">-</span>
    <% end %>
  </td>
  <td>
    <% if submission.validated_at %>
      <small><%= submission.validated_at.strftime('%d/%m/%Y') %></small>
    <% else %>
      <span class="text-muted">-</span>
    <% end %>
  </td>
  <td>
    <div class="btn-group btn-group-sm" role="group">
      <% if submission.document_file.attached? %>
        <button class="btn btn-outline-primary preview-btn"
                data-submission-id="<%= submission.id %>"
                data-document-type="<%= submission.document_type&.name %>"
                title="Ver previsualizaciÃ³n">
          <i class="bi bi-eye"></i>
        </button>
        <a href="<%= download_business_transaction_document_submission_path(business_transaction, submission) %>"
           class="btn btn-outline-info"
           title="Descargar">
          <i class="bi bi-download"></i>
        </a>
      <% end %>

      <% if current_user.admin? || current_user.agent? %>
        <% if submission.document_file.attached? && submission.document_status&.name != 'validado' %>
          <button class="btn btn-outline-success validate-btn"
                  data-submission-id="<%= submission.id %>"
                  title="Validar documento">
            <i class="bi bi-check-circle"></i>
          </button>
          <button class="btn btn-outline-danger reject-btn"
                  data-submission-id="<%= submission.id %>"
                  title="Rechazar documento">
            <i class="bi bi-x-circle"></i>
          </button>
        <% end %>
      <% end %>

      <% if !submission.document_file.attached? || (current_user == submission.uploaded_by || current_user.admin?) %>
        <button class="btn btn-outline-warning upload-btn"
                data-submission-id="<%= submission.id %>"
                title="Cargar/Recargar documento">
          <i class="bi bi-upload"></i>
        </button>
      <% end %>
    </div>
  </td>
</tr>