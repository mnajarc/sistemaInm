<div class="co-owner-item border rounded p-3 mb-3" data-co-owners-target="item">
  <div class="row align-items-center">

    <!-- BÚSQUEDA DE CLIENTE -->
    <div class="col-md-4" data-controller="client-search">
      <label class="form-label">Cliente</label>
      <%= f.hidden_field :client_id, data: { client_search_target: "hiddenField" } %>

      <div class="position-relative">
        <input type="text"
               class="form-control"
               placeholder="Buscar por nombre o email..."
               value="<%= f.object.client&.display_name %>"
               data-client-search-target="input"
               data-action="input->client-search#search"
               autocomplete="off">

        <div class="list-group position-absolute w-100 shadow-sm"
             style="display:none; z-index:1050; max-height:200px; overflow-y:auto;"
             data-client-search-target="results">
        </div>
      </div>

      <div data-client-search-target="selectedDisplay" class="mt-1">
        <% if f.object.client.present? %>
          <span class="badge bg-success"><%= f.object.client.display_name %></span>
        <% end %>
      </div>
    </div>

    <!-- NOMBRE MANUAL (fallback) -->
    <div class="col-md-3">
      <%= f.label :person_name, "O escribir nombre", class: "form-label" %>
      <%= f.text_field :person_name,
                       placeholder: "Nombre completo",
                       class: "form-control" %>
    </div>

    <!-- PORCENTAJE -->
    <div class="col-md-2">
      <%= f.label :percentage, "Porcentaje", class: "form-label" %>
      <div class="input-group">
        <%= f.number_field :percentage,
                           class: "form-control",
                           step: 0.01,
                           min: 0,
                           max: 100,
                           value: f.object.percentage || 100,
                           data: { action: "input->co-owners#updatePercentages" } %>
        <span class="input-group-text">%</span>
      </div>
    </div>

    <!-- ROL -->
    <div class="col-md-2">
      <%= f.label :role, "Rol", class: "form-label" %>
     <%= f.select :role, 
      options_for_select([
        ['Vendedor', 'vendedor'],
        ['Copropietario', 'copropietario'],
        ['Propietario', 'propietario']
      ], f.object.role.presence || 'copropietario'),  # ← Valor por defecto
      {},
      { class: 'form-select', required: true } %>
 


    </div>

    <!-- ELIMINAR -->
    <div class="col-md-1">
      <%= f.hidden_field :_destroy, value: 0, data: { co_owners_target: "destroyField" } %>
      <label class="form-label">&nbsp;</label>
      <button type="button"
              class="btn btn-outline-danger btn-sm d-block"
              data-action="click->co-owners#removeCoOwner"
              title="Eliminar">
        <i class="fas fa-trash"></i>
      </button>
    </div>
  </div>
  <!-- BOTÓN NUEVO CLIENTE (abre modal) -->
  <div class="row mt-2">
    <div class="col-md-4">
      <button type="button"
              class="btn btn-outline-success btn-sm"
              data-bs-toggle="modal"
              data-bs-target="#newClientModal">
        <i class="fas fa-user-plus"></i> Nuevo cliente
      </button>
    </div>
  </div>

</div>
