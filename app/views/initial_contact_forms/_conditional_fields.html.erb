<!-- app/views/initial_contact_forms/_conditional_fields.html.erb -->
<!-- CAMPOS CONDICIONALES POR M√âTODO DE ADQUISICI√ìN -->
<!-- CORRECCI√ìN: Usar data-originally-required en lugar de required -->
<!-- ========================================================================== -->
<!-- CAMPOS GLOBALES - SIEMPRE VISIBLES                                         -->
<!-- ========================================================================== -->

<!-- COMPRAVENTA -->
<div id="compraventa-fields" class="conditional-section" style="display: none;">
  <div class="card">
    <div class="card-header bg-info text-white">
      <h5 class="mb-0">üìã Detalles de Compraventa</h5>
    </div>
    <div class="card-body">
      <div class="alert alert-info">
        <strong>Compraventa:</strong> Informaci√≥n b√°sica del contrato de compraventa
      </div>
      
      <div class="row">
        <div class="col-md-6 mb-3">
          <%= label_tag 'acquisition_details_co_owners_count', 'N√∫mero de copropietarios *', class: 'form-label' %>
          <%= number_field_tag 'initial_contact_form[acquisition_details][co_owners_count]',
                              form.acquisition_details['co_owners_count'] || 1,
                              class: 'form-control', min: 1,
                              data: { originally_required: 'true' } %>
        </div>
        
      </div>
      
      <div class="mb-3">
        <div class="form-check">
          <%= check_box_tag 'initial_contact_form[acquisition_details][has_relationship]', '1',
                           form.acquisition_details['has_relationship'],
                           class: 'form-check-input', id: 'has_relationship_check' %>
          <%= label_tag 'has_relationship_check', '¬øLos copropietarios tienen parentesco?',
                        class: 'form-check-label' %>
        </div>
      </div>
      
      <div id="relationship-field" style="<%= 'display:none;' unless form.acquisition_details['has_relationship'] %>">
        <div class="mb-3">
          <%= label_tag 'acquisition_details_relationship_type', 'Especifique el parentesco',
                        class: 'form-label' %>
          <%= select_tag 'initial_contact_form[acquisition_details][relationship_type]',
                         options_for_select([
                           ['Esposos', 'esposos'],
                           ['Hermanos', 'hermanos'],
                           ['Padres e hijos', 'padres_hijos'],
                           ['Primos', 'primos'],
                           ['T√≠os y sobrinos', 'tios_sobrinos'],
                           ['Otro', 'otro']
                         ], form.acquisition_details['relationship_type']),
                         class: 'form-select' %>
        </div>
      </div>
      
      <div class="mb-3">
        <div class="form-check">
          <%= check_box_tag 'initial_contact_form[acquisition_details][acquired_pre_2014]', '1',
                           form.acquisition_details['acquired_pre_2014'],
                           class: 'form-check-input' %>
          <%= label_tag 'acquired_pre_2014', '¬øSe adquiri√≥ antes de 2014?',
                        class: 'form-check-label' %>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- HERENCIA -->
<div id="herencia-fields" class="conditional-section" style="display: none;">
  <div class="card">
    <div class="card-header bg-warning text-dark">
      <h5 class="mb-0">üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Detalles de Herencia</h5>
    </div>
    <div class="card-body">
      <div class="alert alert-warning">
        <strong>Herencia:</strong> Informaci√≥n sobre los herederos y la sucesi√≥n
      </div>
      
      <div class="row">
        <div class="col-md-4 mb-3">
          <%= label_tag 'acquisition_details_heirs_count', 'N√∫mero de herederos directos *',
                        class: 'form-label' %>
          <%= number_field_tag 'initial_contact_form[acquisition_details][heirs_count]',
                              form.acquisition_details['heirs_count'],
                              class: 'form-control', min: 1,
                              data: { originally_required: 'true' } %>
        </div>
        
        <div class="col-md-4 mb-3">
          <%= label_tag 'acquisition_details_all_living', '¬øTodos viven?', class: 'form-label' %>
          <%= select_tag 'initial_contact_form[acquisition_details][all_living]',
                         options_for_select([['S√≠', 'true'], ['No', 'false']],
                                           form.acquisition_details['all_living']),
                         class: 'form-select', id: 'all_living_select' %>
        </div>
        
        <div class="col-md-4 mb-3" id="deceased-count-field"
             style="<%= 'display:none;' unless form.acquisition_details['all_living'] == 'false' %>">
          <%= label_tag 'acquisition_details_deceased_count', '¬øCu√°ntos han fallecido?',
                        class: 'form-label' %>
          <%= number_field_tag 'initial_contact_form[acquisition_details][deceased_count]',
                              form.acquisition_details['deceased_count'],
                              class: 'form-control', min: 0 %>
        </div>
      </div>
      
      <div class="row">
        <div class="col-md-6 mb-3">
          <%= label_tag 'acquisition_details_all_married', '¬øTodos est√°n casados?',
                        class: 'form-label' %>
          <%= select_tag 'initial_contact_form[acquisition_details][all_married]',
                         options_for_select([['S√≠', 'true'], ['No', 'false']],
                                           form.acquisition_details['all_married']),
                         class: 'form-select', id: 'all_married_select' %>
        </div>
        
        <div class="col-md-6 mb-3" id="single-count-field"
             style="<%= 'display:none;' unless form.acquisition_details['all_married'] == 'false' %>">
          <%= label_tag 'acquisition_details_single_heirs_count', '¬øCu√°ntos solteros?',
                        class: 'form-label' %>
          <%= number_field_tag 'initial_contact_form[acquisition_details][single_heirs_count]',
                              form.acquisition_details['single_heirs_count'],
                              class: 'form-control', min: 0 %>
        </div>
      </div>
      
      <div class="mb-3">
        <%= label_tag 'acquisition_details_deceased_civil_status', 'Estado civil del finado/a *',
                      class: 'form-label' %>
        <%= select_tag 'initial_contact_form[acquisition_details][deceased_civil_status]',
                       options_for_select([
                         ['Soltero(a)', 'soltero'],
                         ['Casado(a)', 'casado'],
                         ['Divorciado(a)', 'divorciado'],
                         ['Viudo(a)', 'viudo'],
                         ['Uni√≥n libre', 'union_libre']
                       ], form.acquisition_details['deceased_civil_status']),
                       class: 'form-select',
                       data: { originally_required: 'true' } %>
      </div>
      
      <div class="mb-3">
        <%= label_tag 'acquisition_details_inheritance_from', '¬øDe qui√©n es la herencia? *',
                      class: 'form-label' %>
        <%= select_tag 'initial_contact_form[acquisition_details][inheritance_from]',
                       options_for_select([
                         ['Ambos padres', 'ambos_padres'],
                         ['Padre', 'padre'],
                         ['Madre', 'madre'],
                         ['C√≥nyuge', 'conyuge'],
                         ['Otro', 'otro']
                       ], form.acquisition_details['inheritance_from']),
                       class: 'form-select', id: 'inheritance_from_select',
                       data: { originally_required: 'true' } %>
      </div>
      
      <div id="inheritance-other-field"
           style="<%= 'display:none;' unless form.acquisition_details['inheritance_from'] == 'otro' %>">
        <div class="mb-3">
          <%= label_tag 'acquisition_details_inheritance_from_other', 'Especifique',
                        class: 'form-label' %>
          <%= text_field_tag 'initial_contact_form[acquisition_details][inheritance_from_other]',
                            form.acquisition_details['inheritance_from_other'],
                            class: 'form-control', maxlength: 100,
                            placeholder: 'Ej: Hermano, t√≠o, abuelo...' %>
        </div>
      </div>
      
      <div class="mb-3">
        <%= label_tag 'acquisition_details_parents_were_married', '¬øLos padres estaban casados?',
                      class: 'form-label' %>
        <%= select_tag 'initial_contact_form[acquisition_details][parents_were_married]',
                       options_for_select([['S√≠', 'true'], ['No', 'false']],
                                         form.acquisition_details['parents_were_married']),
                       class: 'form-select', id: 'parents_married_select' %>
      </div>
      
      <div id="parents-regime-field" style="display: none;">
        <div class="mb-3">
          <%= label_tag 'acquisition_details_parents_marriage_regime',
                        'R√©gimen matrimonial de los padres', class: 'form-label' %>
          <%= collection_select 'initial_contact_form[acquisition_details]', :parents_marriage_regime,
                                MarriageRegime.active.ordered,
                                :name, :display_name,
                                { prompt: 'Seleccione...' },
                                { class: 'form-select' } %>
        </div>
      </div>
      
      <div class="mb-3">
        <%= label_tag 'acquisition_details_has_testamentary', '¬øTiene sucesi√≥n testamentaria? *',
                      class: 'form-label' %>
        <%= select_tag 'initial_contact_form[acquisition_details][has_testamentary_succession]',
                       options_for_select([['S√≠', 'true'], ['No', 'false']],
                                         form.acquisition_details['has_testamentary_succession']),
                       class: 'form-select', id: 'has_testamentary_select',
                       data: { originally_required: 'true' } %>
      </div>
      
      <div id="no-testamentary-field" style="display: none;">
        <div class="mb-3">
          <%= label_tag 'acquisition_details_succession_planned_date', '¬øCu√°ndo planea hacerla?',
                        class: 'form-label' %>
          <%= date_field_tag 'initial_contact_form[acquisition_details][succession_planned_date]',
                            form.acquisition_details['succession_planned_date'],
                            class: 'form-control' %>
        </div>
      </div>
      
      <div id="yes-testamentary-field" style="display: none;">
        <div class="mb-3">
          <%= label_tag 'acquisition_details_succession_authority', '¬øPor juzgado o notar√≠a?',
                        class: 'form-label' %>
          <%= select_tag 'initial_contact_form[acquisition_details][succession_authority]',
                         options_for_select([
                           ['Juzgado', 'juzgado'],
                           ['Notar√≠a', 'notaria']
                         ], form.acquisition_details['succession_authority']),
                         class: 'form-select' %>

        </div>

        <div class="col-md-6 mb-3">
          <%= label_tag 'succession_type', '¬øC√≥mo se llev√≥ a cabo la sucesi√≥n? *', class: 'form-label' %>
          <%= select_tag 'initial_contact_form[acquisition_details][succession_type]',
                        options_for_select([
                          ['Seleccione...', ''],
                          ['Juzgado', 'juzgado'],
                          ['Notar√≠a', 'notaria'],
                          ['En proceso', 'en_proceso']
                        ], form.acquisition_details['succession_type']),
                        id: 'succession_type_select',
                        class: 'form-select',
                        data: { originally_required: 'true' } %>
        </div>
      </div>





    </div>
  </div>
</div>

<!-- USUCAPI√ìN Y PRESCRIPCI√ìN NEGATIVA -->
<div id="usucapion-fields" class="conditional-section" style="display: none;">
  <div class="card">
    <div class="card-header bg-info text-white">
      <h5 class="mb-0">‚öñÔ∏è Detalles de Usucapi√≥n/Prescripci√≥n</h5>
    </div>
    <div class="card-body">
      <div class="alert alert-info">
        <strong>Usucapi√≥n / Prescripci√≥n:</strong> Documentos judiciales y notariales
      </div>
      
      <div class="row">
        <div class="col-md-6 mb-3">
          <div class="form-check">
            <%= check_box_tag 'initial_contact_form[acquisition_details][has_judicial_sentence]', '1',
                             form.acquisition_details['has_judicial_sentence'],
                             class: 'form-check-input' %>
            <%= label_tag 'has_judicial_sentence', '¬øTiene sentencia del juez?',
                          class: 'form-check-label' %>
          </div>
        </div>
        
        <div class="col-md-6 mb-3">
          <div class="form-check">
            <%= check_box_tag 'initial_contact_form[acquisition_details][has_notarial_deed]', '1',
                             form.acquisition_details['has_notarial_deed'],
                             class: 'form-check-input' %>
            <%= label_tag 'has_notarial_deed', '¬øTiene escritura ante notario?',
                          class: 'form-check-label' %>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- DACI√ìN EN PAGO -->
<div id="dacion-pago-fields" class="conditional-section" style="display: none;">
  <div class="card">
    <div class="card-header bg-success text-white">
      <h5 class="mb-0">üí∞ Detalles de Daci√≥n en Pago</h5>
    </div>
    <div class="card-body">
      <div class="alert alert-info">
        <strong>Daci√≥n en Pago:</strong> Documentaci√≥n de la daci√≥n
      </div>
      
      <div class="row">
        <div class="col-md-6 mb-3">
          <%= label_tag 'acquisition_details_document_type',
                        '¬øCon qu√© documento avala la propiedad? *', class: 'form-label' %>
          <%= select_tag 'initial_contact_form[acquisition_details][document_type]',
                         options_for_select([
                           ['Escritura P√∫blica', 'escritura_publica'],
                           ['Sentencia Judicial', 'sentencia_judicial'],
                           ['Ambos', 'ambos']
                         ], form.acquisition_details['document_type']),
                         class: 'form-select',
                         data: { originally_required: 'true' } %>
        </div>
        
        <div class="col-md-6 mb-3">
          <%= label_tag 'acquisition_details_co_owners_count', 'N√∫mero de copropietarios',
                        class: 'form-label' %>
          <%= number_field_tag 'initial_contact_form[acquisition_details][co_owners_count]',
                              form.acquisition_details['co_owners_count'] || 1,
                              class: 'form-control', min: 1 %>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- DONACI√ìN -->
<div id="donacion-fields" class="conditional-section" style="display: none;">
  <div class="card">
    <div class="card-header bg-primary text-white">
      <h5 class="mb-0">üéÅ Detalles de Donaci√≥n</h5>
    </div>
    <div class="card-body">
      <div class="alert alert-info">
        <strong>Donaci√≥n:</strong> Informaci√≥n del donante y beneficiarios
      </div>
      
      <div class="row">
        <div class="col-md-6 mb-3">
          <%= label_tag 'acquisition_details_donor_name', 'Nombre completo del donante *',
                        class: 'form-label' %>
          <%= text_field_tag 'initial_contact_form[acquisition_details][donor_name]',
                            form.acquisition_details['donor_name'],
                            class: 'form-control',
                            placeholder: 'Ej: Juan P√©rez Garc√≠a',
                            data: { originally_required: 'true' } %>
        </div>
        
        <div class="col-md-6 mb-3">
          <%= label_tag 'acquisition_details_donor_relationship', 'Relaci√≥n con el donante *',
                        class: 'form-label' %>
          <%= select_tag 'initial_contact_form[acquisition_details][donor_relationship]',
                         options_for_select([
                           ['Padre', 'padre'],
                           ['Madre', 'madre'],
                           ['Hermano', 'hermano'],
                           ['T√≠o', 'tio'],
                           ['Abuelo', 'abuelo'],
                           ['C√≥nyuge', 'conyuge'],
                           ['Otro', 'otro']
                         ], form.acquisition_details['donor_relationship']),
                         class: 'form-select', id: 'donor_relationship_select',
                         data: { originally_required: 'true' } %>
        </div>
      </div>
      
      <div id="donor-other-field"
           style="<%= 'display:none;' unless form.acquisition_details['donor_relationship'] == 'otro' %>">
        <div class="mb-3">
          <%= label_tag 'acquisition_details_donor_relationship_other', 'Especifique relaci√≥n',
                        class: 'form-label' %>
          <%= text_field_tag 'initial_contact_form[acquisition_details][donor_relationship_other]',
                            form.acquisition_details['donor_relationship_other'],
                            class: 'form-control', maxlength: 100 %>
        </div>
      </div>
      
      <div class="mb-3">
        <%= label_tag 'acquisition_details_beneficiaries_count',
                      'N√∫mero de beneficiarios de la donaci√≥n *', class: 'form-label' %>
        <%= number_field_tag 'initial_contact_form[acquisition_details][beneficiaries_count]',
                            form.acquisition_details['beneficiaries_count'] || 1,
                            class: 'form-control', min: 1,
                            data: { originally_required: 'true' } %>
        <small class="text-muted">Los nombres completos se capturar√°n en la Business Transaction</small>
      </div>
    </div>
  </div>
</div>

<!-- JAVASCRIPT INTERNO PARA CAMPOS CONDICIONALES -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  // HERENCIA: Campos condicionales
  const allLivingSelect = document.getElementById('all_living_select');
  const deceasedCountField = document.getElementById('deceased-count-field');
  
  if (allLivingSelect) {
    allLivingSelect.addEventListener('change', function() {
      deceasedCountField.style.display = this.value === 'false' ? 'block' : 'none';
    });
  }
  
  const allMarriedSelect = document.getElementById('all_married_select');
  const singleCountField = document.getElementById('single-count-field');
  
  if (allMarriedSelect) {
    allMarriedSelect.addEventListener('change', function() {
      singleCountField.style.display = this.value === 'false' ? 'block' : 'none';
    });
  }
  
  const inheritanceFromSelect = document.getElementById('inheritance_from_select');
  const inheritanceOtherField = document.getElementById('inheritance-other-field');
  
  if (inheritanceFromSelect) {
    inheritanceFromSelect.addEventListener('change', function() {
      inheritanceOtherField.style.display = this.value === 'otro' ? 'block' : 'none';
    });
  }
  
  const parentsMarriedSelect = document.getElementById('parents_married_select');
  const parentsRegimeField = document.getElementById('parents-regime-field');
  
  if (parentsMarriedSelect) {
    parentsMarriedSelect.addEventListener('change', function() {
      parentsRegimeField.style.display = this.value === 'true' ? 'block' : 'none';
    });
  }
  
  const hasTestamentarySelect = document.getElementById('has_testamentary_select');
  const noTestamentaryField = document.getElementById('no-testamentary-field');
  const yesTestamentaryField = document.getElementById('yes-testamentary-field');
  
  if (hasTestamentarySelect) {
    hasTestamentarySelect.addEventListener('change', function() {
      noTestamentaryField.style.display = this.value === 'false' ? 'block' : 'none';
      yesTestamentaryField.style.display = this.value === 'true' ? 'block' : 'none';
    });
  }
  
  // COMPRAVENTA: Parentesco
  const hasRelationshipCheck = document.getElementById('has_relationship_check');
  const relationshipField = document.getElementById('relationship-field');
  
  if (hasRelationshipCheck) {
    hasRelationshipCheck.addEventListener('change', function() {
      relationshipField.style.display = this.checked ? 'block' : 'none';
    });
  }
  
  // DONACI√ìN: Relaci√≥n otro
  const donorRelationshipSelect = document.getElementById('donor_relationship_select');
  const donorOtherField = document.getElementById('donor-other-field');
  
  if (donorRelationshipSelect) {
    donorRelationshipSelect.addEventListener('change', function() {
      donorOtherField.style.display = this.value === 'otro' ? 'block' : 'none';
    });
  }
});
</script>
